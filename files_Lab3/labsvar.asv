

% 1.1 ----------------------------------------

load('spectra.mat'); % Ladda spektraldata

R = ones(size(wavelength)); % Ideal vit yta (100% reflektans)

% Ber√§kna vitpunkten f√∂r CIED65
XYZ_D65 = spectra2xyz(R, CIED65); 

% Visa resultatet
disp('Ber√§knad vitpunkt f√∂r CIED65:');
disp(XYZ_D65);

% J√§mf√∂r med teoretiska v√§rden
% XYZ_theoretical = [95.04, 100, 108.88]; 
% disp('Teoretiska v√§rden f√∂r vitpunkten:');
% disp(XYZ_theoretical);

% Ber√§kna skillnaden mellan ber√§knade och teoretiska v√§rden
% diff = XYZ_D65 - XYZ_theoretical;
% disp('Skillnad mellan ber√§knade och teoretiska v√§rden:');
% disp(diff);

%% 1.2 ----------------------------------------------

% Ladda spektrala data
load('spectra.mat'); 

% Ber√§kna XYZ f√∂r R1 och R2 under CIED65-belysning
[X_R1, Y_R1, Z_R1] = spectra2xyz(R1, CIED65);
[X_R2, Y_R2, Z_R2] = spectra2xyz(R2, CIED65);

% Visa resultaten separat
disp('XYZ-v√§rden f√∂r R1 under CIED65:');
disp(['X = ', num2str(X_R1)]);
disp(['Y = ', num2str(Y_R1)]);
disp(['Z = ', num2str(Z_R1)]);

disp('XYZ-v√§rden f√∂r R2 under CIED65:');
disp(['X = ', num2str(X_R2)]);
disp(['Y = ', num2str(Y_R2)]);
disp(['Z = ', num2str(Z_R2)]);

% Plotta reflektansfunktionerna
% figure;
% plot(wavelength, R1, 'b', 'LineWidth', 2); % R1 i bl√•tt
% hold on;
% plot(wavelength, R2, 'r', 'LineWidth', 2); % R2 i r√∂tt
% hold off;

% L√§gg till etiketter och titel
% xlabel('V√•gl√§ngd (nm)');
% ylabel('Reflektans');
% title('Reflektansspektra f√∂r R1 och R2');
% legend('R1', 'R2');
% grid on;

%% 1.3

% Ladda spektrala data
load('spectra.mat'); 

% Ber√§kna XYZ-v√§rden f√∂r R1 och R2 under F11-belysning
[X_R1_F11, Y_R1_F11, Z_R1_F11] = spectra2xyz(R1, f11);
[X_R2_F11, Y_R2_F11, Z_R2_F11] = spectra2xyz(R2, f11);

% Visa resultaten separat
disp('XYZ-v√§rden f√∂r R1 under F11:');
disp(['X = ', num2str(X_R1_F11)]);
disp(['Y = ', num2str(Y_R1_F11)]);
disp(['Z = ', num2str(Z_R1_F11)]);

disp('XYZ-v√§rden f√∂r R2 under F11:');
disp(['X = ', num2str(X_R2_F11)]);
disp(['Y = ', num2str(Y_R2_F11)]);
disp(['Z = ', num2str(Z_R2_F11)]);


%% 1.4 Teorifr√•ga

% Vad har h√§nt?
% N√§r belysningen √§ndrades fr√•n CIED65 till F11, f√∂r√§ndrades f√§rgerna p√• objekten. 
% Vissa f√§rger blev mer m√§ttade, medan andra √§ndrade utseende. 
% Detta beror p√• att F11 har en icke-kontinuerlig spektralf√∂rdelning med endast tre smala v√•gl√§ngdsband.

% Vad kallas fenomenet?
% Detta fenomen kallas metamerism. Det inneb√§r att f√§rger kan se lika ut under en ljusk√§lla men olika under en annan. 
% Eftersom F11 har en begr√§nsad spektral t√§ckning, p√•verkas f√§rg√•tergivningen och vissa f√§rger kan verka felaktiga eller mer m√§ttade j√§mf√∂rt med dagsljus (CIED65).

%% 1.5 

% Ladda spektrala data
load('spectra.mat'); 

% XYZ-v√§rden f√∂r objekten fr√•n uppgift 1.2 (under CIED65)
[X_R1_CIED65, Y_R1_CIED65, Z_R1_CIED65] = spectra2xyz(R1, CIED65);
[X_R2_CIED65, Y_R2_CIED65, Z_R2_CIED65] = spectra2xyz(R2, CIED65);

% XYZ-v√§rden f√∂r objekten fr√•n uppgift 1.3 (under F11)
[X_R1_F11, Y_R1_F11, Z_R1_F11] = spectra2xyz(R1, f11);
[X_R2_F11, Y_R2_F11, Z_R2_F11] = spectra2xyz(R2, f11);

% Konvertera XYZ till RGB med myxyz2rgb
[R1_CIED65, G1_CIED65, B1_CIED65] = myxyz2rgb(X_R1_CIED65, Y_R1_CIED65, Z_R1_CIED65);
[R2_CIED65, G2_CIED65, B2_CIED65] = myxyz2rgb(X_R2_CIED65, Y_R2_CIED65, Z_R2_CIED65);
[R1_F11, G1_F11, B1_F11] = myxyz2rgb(X_R1_F11, Y_R1_F11, Z_R1_F11);
[R2_F11, G2_F11, B2_F11] = myxyz2rgb(X_R2_F11, Y_R2_F11, Z_R2_F11);

% Skapa en f√§rgkarta med de fyra RGB-v√§rdena
map = [
    R1_CIED65, G1_CIED65, B1_CIED65;  % R1 under CIED65
    R2_CIED65, G2_CIED65, B2_CIED65;  % R2 under CIED65
    R1_F11, G1_F11, B1_F11;           % R1 under F11
    R2_F11, G2_F11, B2_F11            % R2 under F11
];

% Klipp RGB-v√§rden s√• att de ligger inom [0,1]
map = min(1, max(0, map));

% Skapa och visa bilden med de fyra f√§rgerna
figure;
image([1 2; 3 4]);
colormap(map);
axis off;
title('F√§rg√•tergivning av R1 och R2 under CIED65 och F11');

% har sparat bilden manuellt och d√∂pte den till fargatergivningR1R2

%% 1.6 Teorifr√•ga

% F√§rgmatchningsfunktionerna 
% ùë•(ùúÜ), ùë¶(ùúÜ) och ùëß(ùúÜ) beskriver hur det m√§nskliga √∂gat uppfattar ljus vid olika v√•gl√§ngder. 
% De representerar √∂gats tre tappreceptorer:

% ùë•(ùúÜ) motsvarar r√∂d k√§nslighet.
% ùë¶(ùúÜ) motsvarar gr√∂n k√§nslighet och best√§mmer ljushet.
% ùëß(ùúÜ) motsvarar bl√• k√§nslighet.
%Dessa funktioner anv√§nds i CIEXYZ-systemet f√∂r att ber√§kna tristimulusv√§rden, 
% vilket g√∂r det m√∂jligt att kvantifiera f√§rg matematiskt.

%% 1.7 Teorifr√•ga

% CIE Y-v√§rdet f√∂r en ljusk√§lla √§r alltid 100 eftersom normaliseringsfaktorn ùëò i ekvation 1.4 s√§kerst√§ller detta.
% Y-v√§rdet representerar ljusstyrka, och f√∂r en helt vit yta √§r Y = 100 per definition. 
% Detta g√∂r att vi kan j√§mf√∂ra f√§rger och ljusk√§llor konsekvent i CIEXYZ-f√§rgsystemet.

%% 2.1

% XYZ-v√§rden fr√•n tabellen
X_paper = 80.43; Y_paper = 84.00; Z_paper = 96.50;
X_cyan_magenta = 7.40; Y_cyan_magenta = 5.74; Z_cyan_magenta = 40.36;

% Dot-on-dot (50% papper, 50% cyan + magenta)------
X_on = 0.5 * X_paper + 0.5 * X_cyan_magenta;
Y_on = 0.5 * Y_paper + 0.5 * Y_cyan_magenta;
Z_on = 0.5 * Z_paper + 0.5 * Z_cyan_magenta;

disp('XYZ f√∂r Dot-on-Dot:');
disp([X_on, Y_on, Z_on]);

% XYZ-v√§rden fr√•n tabellen
X_cyan = 25.84; Y_cyan = 42.52; Z_cyan = 80.88;
X_magenta = 37.36; Y_magenta = 18.44; Z_magenta = 27.52;

% Dot-off-dot (50% cyan, 50% magenta) ----------
X_off = 0.5 * X_cyan + 0.5 * X_magenta;
Y_off = 0.5 * Y_cyan + 0.5 * Y_magenta;
Z_off = 0.5 * Z_cyan + 0.5 * Z_magenta;

disp('XYZ f√∂r Dot-off-Dot:');
disp([X_off, Y_off, Z_off]);

%% 2.2

% Ladda spektrala data
load('spectra.mat'); 

% XYZ-v√§rden fr√•n tabellen
XYZ_none = [80.43, 84.00, 96.50];
XYZ_cyan = [25.84, 42.52, 80.88];
XYZ_magenta = [37.36, 18.44, 27.52];
XYZ_cyan_magenta = [7.40, 5.74, 40.36];

% Tidigare ber√§knade v√§rden f√∂r Dot-on-dot och Dot-off-dot
XYZ_dot_on = [X_on, Y_on, Z_on];
XYZ_dot_off = [X_off, Y_off, Z_off];

% Konvertera XYZ till RGB
[R_none, G_none, B_none] = myxyz2rgb(XYZ_none(1), XYZ_none(2), XYZ_none(3));
[R_cyan, G_cyan, B_cyan] = myxyz2rgb(XYZ_cyan(1), XYZ_cyan(2), XYZ_cyan(3));
[R_magenta, G_magenta, B_magenta] = myxyz2rgb(XYZ_magenta(1), XYZ_magenta(2), XYZ_magenta(3));
[R_cyan_mag, G_cyan_mag, B_cyan_mag] = myxyz2rgb(XYZ_cyan_magenta(1), XYZ_cyan_magenta(2), XYZ_cyan_magenta(3));
[R_dot_on, G_dot_on, B_dot_on] = myxyz2rgb(XYZ_dot_on(1), XYZ_dot_on(2), XYZ_dot_on(3));
[R_dot_off, G_dot_off, B_dot_off] = myxyz2rgb(XYZ_dot_off(1), XYZ_dot_off(2), XYZ_dot_off(3));

% Skapa en f√§rgkarta med de sex RGB-v√§rdena
map = [
    R_none, G_none, B_none;   % Inget tryck (Papper)
    R_cyan, G_cyan, B_cyan;   % Cyan
    R_magenta, G_magenta, B_magenta; % Magenta
    R_cyan_mag, G_cyan_mag, B_cyan_mag; % Cyan & Magenta
    R_dot_on, G_dot_on, B_dot_on; % Dot-on-dot
    R_dot_off, G_dot_off, B_dot_off % Dot-off-dot
];

% Klipp RGB-v√§rden s√• att de ligger inom [0,1]
map = min(1, max(0, map));

% Skapa och visa bilden med de sex f√§rgerna
figure;
image([1 2 3; 4 5 6]);
colormap(map);
axis off;
title('F√§rg√•tergivning av tryckmetoder');
saveas(gcf, 'color_map_tryck.png')

% Finns det en m√§rkbar skillnad mellan dot-on-dot och dot-off-dot?
% Ja, dot-on-dot (f√§rg√∂verlagring) √§r m√∂rkare √§n dot-off-dot.
% Vilken √§r m√∂rkare och varf√∂r?
% Dot-on-dot √§r m√∂rkare, eftersom cyan och magenta absorberar mer ljus n√§r de √∂verlappar.
% Vid dot-off-dot ligger cyan och magenta bredvid varandra, vilket reflekterar mer ljus.


%% 2.3 Teorifr√•ga

% myxyz2rgb kan inte anv√§ndas i alla applikationer eftersom den antar en specifik RGB-f√§rgrymd och vitpunkt.
% Den √§r enhetsberoende eftersom XYZ √§r enhetsoberoende, 
% medan RGB beror p√• sk√§rmens f√§rgegenskaper. Om en annan sk√§rm eller f√§rgrymd anv√§nds (t.ex. AdobeRGB ist√§llet f√∂r sRGB) kan f√§rgerna bli felaktiga utan korrekt f√§rgkalibrering.

%% 3.1

% L√§s in CMYK-halvtonbilden
[C, M, Y, K] = tiffread('halftone.tif');

% Konvertera till RGB
[R, G, B] = cmyk2rgb(C, M, Y, K);

% Visa RGB-bilden
imshowrgb(R, G, B);
title('RGB-version av halvtonbilden');

% Visa individuella CMYK-kanaler
figure;
subplot(2,2,1); imshow(C); title('Cyan');
subplot(2,2,2); imshow(M); title('Magenta');
subplot(2,2,3); imshow(Y); title('Yellow');
subplot(2,2,4); imshow(K); title('Black');

% V√§lj centrerad del av CMYK-bilden (256x256)
C1 = C(129:384,129:384);
M1 = M(129:384,129:384);
Y1 = Y(129:384,129:384);
K1 = K(129:384,129:384);

% Ber√§kna fraktionell t√§ckning med Demichel's ekvationer
fractional_coverage_test1 = Demichel_test(C1, M1, Y1, K1);

% Visa resultaten 
disp('Fraktionell t√§ckning f√∂r Test 1 (centrerad sektion):');
disp(fractional_coverage_test1);

% Skiftar cyan-kanalen 10 pixlar ned√•t
C2 = C(139:394,129:384); 
M2 = M(129:384,129:384);
Y2 = Y(129:384,129:384);
K2 = K(129:384,129:384);

% Ber√§kna fraktionell t√§ckning f√∂r den skiftade bilden
fractional_coverage_test2 = Demichel_test(C2, M2, Y2, K2);

% Visa resultaten ( test 2 kanske fel v√§rden)
disp('Fraktionell t√§ckning f√∂r Test 2 (misregistration, cyan ned√•t 10 pixlar):');
disp(fractional_coverage_test2);

%% 3.2 Teorifr√•ga

% Demichels ekvationer fungerar v√§l f√∂r att uppskatta f√§rgt√§ckning under idealf√∂rh√•llanden (utan misregistration), 
% men har begr√§nsningar vid feljustering av f√§rger (misregistration).
% Vid sm√• f√∂rskjutningar ger modellen fortfarande rimliga resultat, 
% men vid st√∂rre f√∂rskjutningar kan t√§ckningsgraderna avvika kraftigt.
%Detta beror p√• att ekvationerna antar en perfekt geometrisk rasterplacering, 
% vilket inte alltid motsvarar verkliga tryckfel och mispassning mellan f√§rgkanalerna.

%% 3.3 Teorifr√•ga

% Om alla fyra tryckf√§rger hade samma rastervinkel, 
% skulle moir√©-effekter uppst√•, vilket skulle skapa synliga m√∂nster och f√∂rs√§mra f√§rg√•tergivningen.
% Demichels ekvationer skulle inte fungera korrekt i detta fall,
% eftersom de bygger p√• antagandet att f√§rgseparationerna √§r slumpm√§ssigt distribuerade. 
% N√§r f√§rgerna √∂verlappar p√• ett f√∂ruts√§gbart s√§tt vid samma vinkel, 
% blir modellen ogiltig och kan inte korrekt beskriva fraktionell t√§ckning.

%% 4.1 

% Ladda RGB-bild (om den inte redan √§r inl√§st)
[R, G, B] = tiffread('Butterfly.tif'); % Exempelbild

% Konvertera RGB till CMYK
[C, M, Y, K] = rgb2cmyk(R, G, B);

% Visa CMYK-kanalerna i separata figurer
figure(1);
imshow(C);
title('Cyan kanal');

figure(2);
imshow(M);
title('Magenta kanal');

figure(3);
imshow(Y);
title('Yellow kanal');

figure(4);
imshow(K);
title('Black kanal');

% Teori svaret:

% CMYK-bilderna verkar inverterade eftersom tryckprocessen fungerar subtraktivt. 
% Ljusa omr√•den i en RGB-bild kr√§ver mindre bl√§ck och blir m√∂rka i CMYK-kanalerna, 
% medan m√∂rka omr√•den kr√§ver mer bl√§ck och blir ljusa i CMYK-kanalerna.
% I K-kanalen (svart) betyder en ljus pixel att lite svart bl√§ck trycks, 
% medan en m√∂rk pixel betyder att mer svart bl√§ck appliceras. 
% Samma g√§ller f√∂r Cyan, Magenta och Yellow.

%% 4.2

% Ladda RGB-bilden (om den inte redan √§r inl√§st)
[R, G, B] = tiffread('Butterfly.tif'); % Exempelbild

% Konvertera RGB till CIELAB
[L, a, b] = myrgb2lab(R, G, B);

% √ñka ljusstyrkan med 20 enheter
[R2, G2, B2] = mylab2rgb(L + 20, a, b);

% Minska ljusstyrkan med 20 enheter
[R3, G3, B3] = mylab2rgb(L - 20, a, b);

% Visa den ljusare bilden
figure;
imshowrgb(R2, G2, B2);
title('√ñkad ljusstyrka (+20 i L)');
saveas(gcf, 'increased_lightness.png');


% Visa den m√∂rkare bilden
figure;
imshowrgb(R3, G3, B3);
title('Minskad ljusstyrka (-20 i L)');

% Spara bilderna f√∂r att infoga i svarsdokumentet
saveas(gcf, 'decreased_lightness.png');

% Teori svar:
% N√§r L-v√§rdet √∂kas, blir bilden ljusare, och n√§r L-v√§rdet minskas,blir bilden m√∂rkare. 
% Detta p√•verkar endast ljusstyrkan (lightness) utan att f√∂r√§ndra kontrast, 
% f√§rgton (hue) eller m√§ttnad (saturation).

%% 4.3

% Byt tecken p√• a*-v√§rdena
[R2, G2, B2] = mylab2rgb(L, -a, b);

% Visa resultatet
figure;
imshowrgb(R2, G2, B2);
title('Inverterade a*-v√§rden (r√∂tt blir gr√∂nt, gr√∂nt blir r√∂tt)');

% Spara bilden
saveas(gcf, 'inverted_a_star.png');

% S√§tt alla a*-v√§rden till 0
[R3, G3, B3] = mylab2rgb(L, 0, b);

% Visa resultatet
figure;
imshowrgb(R3, G3, B3);
title('a* = 0 (ingen r√∂d-gr√∂n f√§rginformation)');

% Spara bilden
saveas(gcf, 'zero_a_star.png');

% Teori svar: 
% N√§r vi inverterar a-v√§rdet, f√∂r√§ndras f√§rgens hue (kul√∂r), 
% d√§r r√∂tt blir gr√∂nt och gr√∂nt blir r√∂tt. 
% Detta √§ndrar inte ljusstyrka eller kontrast.*
% N√§r vi s√§tter a till 0, f√∂rsvinner all r√∂d-gr√∂n-information, 
% vilket g√∂r att bilden endast best√•r av bl√•-gula toner. 
% √Ñven h√§r p√•verkas endast hue, inte ljusstyrka eller m√§ttnad.*

%% 4.4

% Ladda RGB-bilden (om den inte redan √§r inl√§st)
[R, G, B] = tiffread('Butterfly.tif'); % Exempelbild

% Konvertera till CIELAB
[L, a, b] = myrgb2lab(R, G, B);

% Minska a* och b* v√§rdena (l√§gre f√§rgm√§ttnad)
[R2, G2, B2] = mylab2rgb(L, 0.5 * a, 0.5 * b);

% √ñka a* och b* v√§rdena (h√∂gre f√§rgm√§ttnad)
[R3, G3, B3] = mylab2rgb(L, 3 * a, 3 * b);

% Visa bilderna
figure;
imshowrgb(R2, G2, B2);
title('Skalning av a* och b* med 0.5 (l√§gre m√§ttnad)');
saveas(gcf, 'lagre_mattnad.png');

figure;
imshowrgb(R3, G3, B3);
title('Skalning av a* och b* med 3 (h√∂gre m√§ttnad)');
saveas(gcf, 'h√∂gre_mattnad.png');

% Teori :

% Den f√§rgegenskap som p√•verkas √§r m√§ttnad (saturation).
% N√§r vi minskar a och b** (skalar med 0.5) minskar m√§ttnaden, 
% vilket g√∂r att bilden ser blekare och mer gr√•aktig ut.
% N√§r vi √∂kar a och b** (skalar med 3) √∂kar m√§ttnaden, 
% vilket g√∂r att f√§rgerna blir starkare och mer livliga.
% Ljusstyrka (lightness) och kul√∂r (hue) p√•verkas inte, eftersom endast f√§rgens kromaticitet √§ndras.


%% 5.1

% Ladda spektrala data
load('spectra.mat'); 

% S√§tt reflektansen till 1 (ideal vit yta)
R = ones(size(wavelength));

% Ber√§kna XYZ-vitpunkten f√∂r varje ljusk√§lla
XYZ_D65 = spectra2xyz(R, CIED65);
XYZ_Tungsten = spectra2xyz(R, Tungsten60W);
XYZ_Plank90K = spectra2xyz(R, plank90K);

% Se till att XYZ √§r i r√§tt format (radvektor 1x3)
if size(XYZ_D65,2) == 1
    XYZ_D65 = XYZ_D65';
    XYZ_Tungsten = XYZ_Tungsten';
    XYZ_Plank90K = XYZ_Plank90K';
end

% Konvertera XYZ till RGB
[R_D65, G_D65, B_D65] = myxyz2rgb(XYZ_D65(1), XYZ_D65(2), XYZ_D65(3));
[R_Tungsten, G_Tungsten, B_Tungsten] = myxyz2rgb(XYZ_Tungsten(1), XYZ_Tungsten(2), XYZ_Tungsten(3));
[R_Plank90K, G_Plank90K, B_Plank90K] = myxyz2rgb(XYZ_Plank90K(1), XYZ_Plank90K(2), XYZ_Plank90K(3));

% Skapa en RGB-matris f√∂r att visa f√§rgerna
RGB_values = [
    R_D65, G_D65, B_D65;        % D65 (dagsljus)
    R_Tungsten, G_Tungsten, B_Tungsten;  % Tungsten 60W (gl√∂dlampa)
    R_Plank90K, G_Plank90K, B_Plank90K   % Plank90K (h√∂g temperatur ljusk√§lla)
];

% Visa f√§rgerna
showRGB(RGB_values);
title('F√§rger f√∂r CIED65, Tungsten60W och Plank90K');

% Spara figuren f√∂r svarsdokumentet
saveas(gcf, 'light_sources.png');

%% 5.2 

% Ladda spektrala data
load('spectra.mat'); 

% Visa de 20 objekten under de tre ljusk√§llorna
showRGB_20;

%% 5.3

% Plot the color differences (ŒîE76) for the 20 objects under different illuminations
plot_deltaE;

% Teori:

% The color differences (ŒîE76) between the objects under Tungsten60W and Plank90K are 
% larger than those under the other two pairs of light sources because these two light sources 
% have the most different spectral distributions.
% Tungsten60W emits mostly warm, red-yellow light, while Plank90K emits more blue light. 
% This results in the same object appearing significantly different under these two illuminations, 
% leading to the largest color differences in the plot.
% CIED65 (daylight) has a more balanced spectrum, 
% so the color differences between objects under CIED65 and the other two light sources are generally smaller.



%% 5.4

% Plot the CIEXYZ values for the light sources and objects under them
plot_XYZ;

% This will generate a 3D plot showing:

% White points of the light sources as circles:
% Black circle (o) ‚Üí CIED65
% Red circle (o) ‚Üí Tungsten60W
% Blue circle (o) ‚Üí Plank90K

% The twenty objects under different light sources:
% Black (x) ‚Üí Under CIED65
% Red (*) ‚Üí Under Tungsten60W
% Blue (+) ‚Üí Under Plank90K

% Teori:
% The Y-value for all light sources in the CIEXYZ space is 100.
% This is because the Y-component represents luminance, and it is normalized to 100
% for a perfectly reflecting white surface under any standard illuminant.
% This normalization ensures that brightness remains consistent regardless of the light source.

%% 5.5

% Plot CIEXYZ values for the objects under different illuminations
plot_XYZ;

% Teori: Yes, when the illumination changes, the twenty objects move to completely different positions in the CIEXYZ space.
% This happens because CIEXYZ values are directly influenced by the spectral distribution of the light source.
% Since different illuminants have different spectral compositions, the way objects reflect light changes, resulting in different XYZ coordinates for the same object under different lighting conditions.
% This shows that CIEXYZ is not perceptually uniform and makes it difficult to compare colors under varying illuminations.

%% 5.6
